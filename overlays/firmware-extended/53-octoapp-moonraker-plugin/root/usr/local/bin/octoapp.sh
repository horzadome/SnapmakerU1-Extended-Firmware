#!/bin/sh
#
# Runs OctoApp Companion Plugin for Klipper/Moonraker.
# Sets required PYTHONPATH and invokes Python module with JSON config.
# This script is generated by the firmware build system.
#

CONFIG_FILE="/home/lava/printer_data/config/extended/octoapp/octoapp-service-config.json"
DATA_DIR="/home/lava/printer_data/octoapp"

if [ ! -d "$DATA_DIR" ]; then
  mkdir -p "$DATA_DIR"
fi
chown -R lava:lava "$DATA_DIR"

if [ ! -f "$CONFIG_FILE" ]; then
  echo "[!] OctoApp config file not found: $CONFIG_FILE" >&2
  exit 1
fi
JSON_CONFIG_BASE64=$(base64 -w 0 "$CONFIG_FILE")

export PYTHONPATH=/home/lava/octoapp

exec /usr/bin/python3 -m moonraker_octoapp "$JSON_CONFIG_BASE64"
