<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ "/assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ "/assets/fontawesome/css/all.min.css" | relative_url }}">
    <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
    <meta name="description" content="{{ page.description | default: site.description | default: site.github.project_tagline }}"/>
    <style>
      :root {
        --bg-color: #ffffff;
        --text-color: #24292e;
        --link-color: #6b7280;
        --link-hover: #4b5563;
        --code-bg: #fafafa;
        --border-color: #e1e4e8;
      }
      
      html[data-theme="light"] {
        --bg-color: #ffffff;
        --text-color: #24292e;
        --link-color: #6b7280;
        --link-hover: #4b5563;
        --code-bg: #fafafa;
        --border-color: #e1e4e8;
      }
      
      html[data-theme="light"] .markdown-body h1,
      html[data-theme="light"] .markdown-body h2,
      html[data-theme="light"] .markdown-body h3,
      html[data-theme="light"] .markdown-body h4,
      html[data-theme="light"] .markdown-body h5,
      html[data-theme="light"] .markdown-body h6 {
        color: #5b6269;
      }
      
      html[data-theme="light"] .markdown-body code,
      html[data-theme="light"] .markdown-body tt {
        background-color: #f0f0f0 !important;
        color: #24292e !important;
        border-radius: 0 !important;
      }
      
      html[data-theme="light"] .markdown-body pre,
      html[data-theme="light"] .markdown-body pre code {
        background-color: #f0f0f0 !important;
        color: #24292e !important;
        border-radius: 0 !important;
      }
      
      html[data-theme="light"] .markdown-body blockquote {
        color: #5a5d61;
      }
      
      html[data-theme="dark"] {
        --bg-color: #1e1e1e;
        --text-color: #d4d4d4;
        --link-color: #9ca3af;
        --link-hover: #d4d4d4;
        --code-bg: #2d2d2d;
        --border-color: #3e3e42;
      }
      
      @media (prefers-color-scheme: dark) {
        html:not([data-theme="light"]) {
          --bg-color: #1e1e1e;
          --text-color: #d4d4d4;
          --link-color: #9ca3af;
          --link-hover: #d4d4d4;
          --code-bg: #2d2d2d;
          --border-color: #3e3e42;
        }
        
        .markdown-body code,
        .markdown-body tt {
          background-color: var(--code-bg) !important;
          color: #ce9178 !important;
          border-radius: 0 !important;
        }
        
        .markdown-body pre,
        .markdown-body pre code {
          background-color: var(--code-bg) !important;
          color: #d4d4d4 !important;
          border-radius: 0 !important;
        }
        
        .markdown-body table tr {
          background-color: #1e1e1e;
          border-top: 1px solid #3e3e42;
        }
        
        .markdown-body table tr:nth-child(2n) {
          background-color: #252526;
        }
        
        .markdown-body table th,
        .markdown-body table td {
          border: 1px solid #3e3e42;
        }
        
        .markdown-body blockquote {
          color: #d4d4d4;
          border-left-color: #007acc;
        }
        
        .markdown-body hr {
          background-color: #3e3e42;
          border-color: #3e3e42;
        }
        
        .markdown-body h1, .markdown-body h2, .markdown-body h3,
        .markdown-body h4, .markdown-body h5, .markdown-body h6 {
          color: #d4d4d4;
        }
        
        .markdown-body a {
          color: #3794ff;
        }
        
        .markdown-body a:hover {
          color: #4daafc;
        }
        
        /* Soften harsh syntax highlighting colors in dark theme */
        .markdown-body .c1,
        .markdown-body .cm,
        .markdown-body .c { color: #6a9955 !important; } /* Comments - green */
        
        .markdown-body .err { color: #d4d4d4 !important; } /* Errors - neutral */
        
        .markdown-body .s,
        .markdown-body .s1,
        .markdown-body .s2,
        .markdown-body .sa,
        .markdown-body .sb,
        .markdown-body .sc,
        .markdown-body .si,
        .markdown-body .sx { color: #ce9178 !important; } /* Strings - soft orange/brown */
        
        .markdown-body .k,
        .markdown-body .kc,
        .markdown-body .kd,
        .markdown-body .kn,
        .markdown-body .kp,
        .markdown-body .kr,
        .markdown-body .nc,
        .markdown-body .n { color: #c89191 !important; } /* Keywords, classes, names - soft mauve */
        
        .markdown-body .m,
        .markdown-body .mb,
        .markdown-body .mf,
        .markdown-body .mh,
        .markdown-body .mi,
        .markdown-body .il { color: #b5cea8 !important; } /* Numbers - soft green */
        
        .markdown-body .o,
        .markdown-body .ow { color: #d4d4d4 !important; } /* Operators - neutral */
        
        /* Catch any remaining bright reds */
        .markdown-body pre code { color: #d4d4d4 !important; }
        
        /* Override any inline span styles that might have red */
        .markdown-body pre code span { color: inherit !important; }
        .markdown-body pre code span[style*="color: #f"] { color: #c89191 !important; }
        .markdown-body pre code span[style*="color: red"] { color: #c89191 !important; }
        
        /* Fallback for any remaining bright colors */
        .markdown-body pre { color: #d4d4d4 !important; }
      }
      
      body {
        background-color: var(--bg-color);
        color: var(--text-color);
      }
      
      .site-header {
        background-color: var(--code-bg);
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      .header-content {
        max-width: 1280px;
        margin: 0 auto;
        padding: 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 2rem;
      }
      
      .header-brand {
        flex-shrink: 0;
      }
      
      .header-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--text-color);
        text-decoration: none;
        transition: color 0.2s ease;
      }
      
      .header-title:hover {
        color: var(--link-color);
      }
      
      .header-nav {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
        align-items: center;
        justify-content: flex-end;
      }
      
      .mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        color: var(--text-color);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0.5rem;
      }
      
      .mobile-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }
      
      .mobile-overlay.active {
        display: block;
      }
      
      .theme-selector {
        display: flex;
        gap: 0;
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        overflow: hidden;
      }
      
      .theme-option {
        background: none;
        border: none;
        border-right: 1px solid var(--border-color);
        padding: 0.5rem 0.7rem;
        color: var(--text-color);
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .theme-option:last-child {
        border-right: none;
      }
      
      .theme-option:hover {
        background-color: var(--code-bg);
        color: var(--link-color);
      }
      
      .theme-option.active {
        background-color: var(--code-bg);
        color: var(--link-hover);
        font-weight: 600;
      }
      
      .header-link {
        color: var(--link-color);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.95rem;
        transition: all 0.2s ease;
        padding: 0.4rem 0.8rem;
        border-radius: 4px;
      }
      
      .header-link:hover {
        color: var(--link-hover);
        background-color: var(--bg-color);
      }
      
      .header-link.active {
        color: var(--link-hover);
        background-color: var(--bg-color);
        font-weight: 600;
      }
      
      body {
        background-color: var(--bg-color);
        color: var(--text-color);
      }
      
      .markdown-body {
        background-color: var(--bg-color);
        color: var(--text-color);
      }
      
      .main-container { 
        display: flex; 
        gap: 2rem; 
      }
      
      .sidebar {
        width: 280px;
        flex-shrink: 0;
        position: sticky;
        top: 1rem;
        align-self: flex-start;
        max-height: calc(100vh - 2rem);
        overflow-y: auto;
        padding: 1rem;
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
      }
      
      .sidebar nav {
        flex: 1;
      }
      
      .sidebar-theme-selector {
        padding-top: 1rem;
        margin-top: 1rem;
        border-top: 1px solid var(--border-color);
      }
      
      .sidebar-theme-selector .theme-selector {
        justify-content: center;
      }
      
      .content {
        flex: 1;
        min-width: 0;
      }
      
      .sidebar ul {
        list-style: none;
        padding-left: 0;
        margin: 0;
      }
      
      .top-level-pages {
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
      }
      
      .sidebar ul ul {
        padding-left: 1.25rem;
      }
      
      .sidebar li {
        margin: 0.25rem 0;
      }
      
      .sidebar a {
        text-decoration: none;
        color: var(--link-color);
        display: block;
        padding: 0.25rem 0;
        line-height: 1.4;
      }
      
      .sidebar a:hover {
        color: var(--link-hover);
        text-decoration: underline;
      }
      
      .sidebar a.active {
        color: var(--link-hover);
        font-weight: 600;
        background-color: var(--code-bg);
        margin-left: -0.5rem;
        margin-right: -0.5rem;
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        border-radius: 4px;
        position: relative;
      }
      
      .sidebar a.active::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background-color: var(--link-color);
        border-radius: 2px;
      }
      
      .menu-section {
        margin: 0.75rem 0;
      }
      
      .menu-section-header {
        font-weight: 600;
        padding: 0.25rem 0;
        user-select: none;
      }
      
      .page-item {
        margin: 0.5rem 0;
      }
      
      .page-link {
        font-weight: 500;
      }
      
      .page-item.collapsed .page-headings {
        display: none;
      }
      
      .page-headings {
        font-size: 0.9em;
        margin-top: 0.25rem;
      }
      
      .page-headings a {
        color: var(--text-color);
        opacity: 0.75;
        padding: 0.15rem 0;
      }
      
      .page-headings a:hover {
        opacity: 1;
      }
      
      @media (max-width: 768px) {
        .mobile-menu-toggle {
          display: block;
        }
        
        .header-nav {
          gap: 0.5rem;
        }
        
        .header-link {
          display: none;
        }
        
        .main-container {
          flex-direction: column;
        }
        
        .sidebar {
          position: fixed;
          top: 0;
          left: -280px;
          height: 100vh;
          width: 280px;
          max-height: 100vh;
          border-right: 1px solid var(--border-color);
          border-bottom: none;
          background-color: var(--bg-color);
          z-index: 1000;
          transition: left 0.3s ease;
          overflow-y: auto;
        }
        
        .sidebar.active {
          left: 0;
          box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .content {
          width: 100%;
        }
      }
      
      /* Table zoom modal styles */
      .table-zoom-button {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background-color: var(--link-color);
        color: white;
        border: none;
        padding: 0.4rem 0.6rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.85em;
        opacity: 0;
        transition: opacity 0.2s;
        z-index: 10;
      }
      
      .markdown-body table:hover .table-zoom-button {
        opacity: 1;
      }
      
      .table-zoom-button:hover {
        background-color: var(--link-hover);
      }
      
      /* Code block copy button styles */
      .code-header {
        position: absolute;
        top: 0;
        right: 0;
        display: flex;
        gap: 0.25rem;
        opacity: 0;
        transition: opacity 0.2s ease;
        padding: 0.5rem;
        z-index: 10;
      }
      
      .markdown-body pre:hover .code-header {
        opacity: 1;
      }
      
      .code-action-btn {
        background-color: var(--code-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 0.35rem 0.6rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.3rem;
      }
      
      .code-action-btn:hover {
        background-color: var(--link-color);
        color: white;
        border-color: var(--link-color);
      }
      
      .code-action-btn.copied {
        background-color: #10b981;
        color: white;
        border-color: #10b981;
      }
      
      .markdown-body pre {
        position: relative;
      }
      
      .table-zoom-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 10000;
        overflow: auto;
        padding: 2rem;
      }
      
      .table-zoom-modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .table-zoom-content {
        background-color: var(--bg-color);
        border-radius: 8px;
        padding: 2rem;
        max-width: 95vw;
        width: 95vw;
        max-height: 90vh;
        overflow: auto;
        position: relative;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }
      
    </style>
  </head>
  <body>
    <div class="mobile-overlay" id="mobile-overlay"></div>
    <header class="site-header">
      <div class="header-content">
        <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">
          <i class="fas fa-bars"></i>
        </button>
        <div class="header-brand">
          <a href="{{ '/' | relative_url }}" class="header-title">{{ site.title }}</a>
        </div>
        <nav class="header-nav">
          {% assign header_pages = site.pages | where_exp: "item", "item.header_order" | sort: 'header_order' %}
          {% for page in header_pages %}
            {% if page.title %}
              <a href="{{ page.url | relative_url }}" class="header-link" data-page="{{ page.url }}">{{ page.title }}</a>
            {% endif %}
          {% endfor %}
        </nav>
      </div>
    </header>
    
    <div class="container-lg px-3 my-5 markdown-body">
      <div class="main-container">
        <aside class="sidebar">
          <nav>
            {% assign sorted_pages = site.pages | sort: 'nav_order' %}
            {% assign sections = sorted_pages | where_exp: "item", "item.nav_section" | map: "nav_section" | uniq %}
            
            {% comment %} Pages without a section at top level (like Home) {% endcomment %}
            <ul class="top-level-pages">
              {% for page in sorted_pages %}
                {% unless page.nav_section %}
                  {% if page.title and page.nav_order %}
                    <li class="page-item">
                      <div class="page-link-wrapper">
                        <a href="{{ page.url | relative_url }}" class="page-link" data-page="{{ page.url }}">
                          {% if page.nav_icon %}<i class="{{ page.nav_icon }}"></i> {% endif %}{{ page.title }}
                        </a>
                      </div>
                    </li>
                  {% endif %}
                {% endunless %}
              {% endfor %}
            </ul>
            
            {% comment %} Create menu sections based on nav_section field {% endcomment %}
            {% for section in sections %}
              <div class="menu-section" data-section="{{ section | slugify }}">
                <div class="menu-section-header">
                  <span>{{ section }}</span>
                </div>
                <ul>
                  {% comment %} Get all pages in this section {% endcomment %}
                  {% for page in sorted_pages %}
                    {% if page.nav_section == section and page.title %}
                      <li class="page-item collapsed" data-page-id="{{ page.url | slugify }}">
                        <a href="{{ page.url | relative_url }}" class="page-link" data-page="{{ page.url }}">
                          {% if page.nav_icon %}<i class="{{ page.nav_icon }}"></i> {% endif %}{{ page.title }}
                        </a>
                        
                        {% comment %} Extract H2 headers from the page {% endcomment %}
                        {% assign h2_tags = page.content | split: '<h2' %}
                        {% if h2_tags.size > 1 %}
                          <ul class="page-headings">
                            {% for h2_tag in h2_tags offset:1 limit:20 %}
                              {% assign id_and_rest = h2_tag | split: 'id="' %}
                              {% if id_and_rest.size > 1 %}
                                {% assign heading_id = id_and_rest[1] | split: '"' | first %}
                                {% assign content_part = h2_tag | split: '>' | slice: 1, 10 | join: '>' %}
                                {% assign heading_text = content_part | split: '</h2>' | first | strip_html | strip %}
                                {% if heading_text != '' %}
                                  <li><a href="{{ page.url | relative_url }}#{{ heading_id }}" data-heading="{{ heading_id }}">{{ heading_text }}</a></li>
                                {% endif %}
                              {% endif %}
                            {% endfor %}
                          </ul>
                        {% endif %}
                      </li>
                    {% endif %}
                  {% endfor %}
                </ul>
              </div>
            {% endfor %}
          </nav>
          
          <div class="sidebar-theme-selector">
            <div class="theme-selector">
              <button class="theme-option" data-theme="light" title="Light theme" aria-label="Light theme"><i class="fas fa-sun"></i></button>
              <button class="theme-option" data-theme="dark" title="Dark theme" aria-label="Dark theme"><i class="fas fa-moon"></i></button>
              <button class="theme-option" data-theme="system" title="System theme" aria-label="System theme"><i class="fas fa-circle-half-stroke"></i></button>
            </div>
          </div>
        </aside>
        
        <div class="content">
          {{ content }}
        </div>
      </div>
    </div>
    <script src="{{ "/assets/anchor.min.js" | relative_url }}"></script>
    <script>
      anchors.add();
      
      // Theme selector functionality
      const THEME_STORAGE_KEY = 'snapmaker-theme-preference';
      const themeOptions = document.querySelectorAll('.theme-option');
      
      function applyTheme(preference) {
        if (preference === 'system') {
          localStorage.removeItem(THEME_STORAGE_KEY);
          document.documentElement.removeAttribute('data-theme');
        } else {
          localStorage.setItem(THEME_STORAGE_KEY, preference);
          document.documentElement.setAttribute('data-theme', preference);
        }
        updateThemeUI();
      }
      
      function updateThemeUI() {
        const preference = localStorage.getItem(THEME_STORAGE_KEY) || 'system';
        themeOptions.forEach(option => {
          if (option.getAttribute('data-theme') === preference) {
            option.classList.add('active');
          } else {
            option.classList.remove('active');
          }
        });
      }
      
      // Apply saved theme immediately on page load
      const savedTheme = localStorage.getItem(THEME_STORAGE_KEY);
      if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
      }
      
      // Theme option handlers
      themeOptions.forEach(option => {
        option.addEventListener('click', () => {
          const theme = option.getAttribute('data-theme');
          applyTheme(theme);
        });
      });
      
      // Initialize theme UI
      updateThemeUI();
      
      // Mobile menu toggle
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const mobileOverlay = document.getElementById('mobile-overlay');
      const sidebar = document.querySelector('.sidebar');
      
      function toggleMobileMenu() {
        sidebar.classList.toggle('active');
        mobileOverlay.classList.toggle('active');
      }
      
      if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', toggleMobileMenu);
      }
      
      if (mobileOverlay) {
        mobileOverlay.addEventListener('click', toggleMobileMenu);
      }
      
      // Close mobile menu when clicking a link
      document.querySelectorAll('.sidebar a').forEach(link => {
        link.addEventListener('click', () => {
          if (window.innerWidth <= 768) {
            sidebar.classList.remove('active');
            mobileOverlay.classList.remove('active');
          }
        });
      });
      
      document.querySelectorAll('.header-link').forEach(link => {
        const linkUrl = link.getAttribute('data-page');
        const currentUrl = window.location.pathname;
        
        const normalizedCurrent = currentUrl.replace(/\/index\.html$/, '/').replace(/\.html$/, '').replace(/\/$/, '') || '/';
        const normalizedLink = linkUrl.replace(/\/index\.html$/, '/').replace(/\.html$/, '').replace(/\/$/, '') || '/';
        
        if (normalizedCurrent === normalizedLink || 
            normalizedCurrent === normalizedLink + '.html' ||
            normalizedCurrent + '.html' === normalizedLink) {
          link.classList.add('active');
        }
      });
      
      // Add zoom buttons to tables
      document.querySelectorAll('.markdown-body table').forEach((table, index) => {
        table.style.position = 'relative';
        const button = document.createElement('button');
        button.className = 'table-zoom-button';
        button.textContent = 'â›¶ Zoom';
        button.setAttribute('data-table-index', index);
        table.appendChild(button);
        
        button.addEventListener('click', (e) => {
          e.preventDefault();
          const modal = document.getElementById('table-zoom-modal');
          const content = document.getElementById('table-zoom-content');
          const tableClone = table.cloneNode(true);
          tableClone.querySelector('.table-zoom-button').remove();
          content.innerHTML = '';
          
          // Wrap cloned table in markdown-body div to preserve styling
          const wrapper = document.createElement('div');
          wrapper.className = 'markdown-body';
          wrapper.appendChild(tableClone);
          content.appendChild(wrapper);
          
          modal.classList.add('active');
        });
      });
      
      // Add copy buttons to code blocks
      setTimeout(() => {
        document.querySelectorAll('.markdown-body pre').forEach((pre) => {
          const header = document.createElement('div');
          header.className = 'code-header';
          
          const copyBtn = document.createElement('button');
          copyBtn.className = 'code-action-btn';
          copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy';
          copyBtn.setAttribute('aria-label', 'Copy code to clipboard');
          
          copyBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const code = pre.querySelector('code');
            const text = code ? code.textContent : pre.textContent;
            
            // Fallback method that works without HTTPS
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
              document.execCommand('copy');
              copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
              copyBtn.classList.add('copied');
              
              setTimeout(() => {
                copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy';
                copyBtn.classList.remove('copied');
              }, 2000);
            } catch (err) {
              console.error('Failed to copy:', err);
            } finally {
              document.body.removeChild(textarea);
            }
          });
          
          header.appendChild(copyBtn);
          pre.appendChild(header);
        });
      }, 100);
      
      // Add modal HTML
      const modal = document.createElement('div');
      modal.id = 'table-zoom-modal';
      modal.className = 'table-zoom-modal';
      modal.innerHTML = '<div class="table-zoom-content" id="table-zoom-content"><button class="table-zoom-close">âŠ— Close</button></div>';
      document.body.appendChild(modal);
      
      // Close modal handlers
      const closeButton = modal.querySelector('.table-zoom-close');
      closeButton.addEventListener('click', () => {
        modal.classList.remove('active');
      });
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.remove('active');
        }
      });
      
      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          modal.classList.remove('active');
        }
      });
      
      // Storage keys
      const PAGE_STORAGE_KEY = 'snapmaker-page-state';
      
      function getPageState() {
        try {
          return JSON.parse(localStorage.getItem(PAGE_STORAGE_KEY) || '{}');
        } catch (e) {
          return {};
        }
      }
      
      function savePageState(pageId, isExpanded) {
        try {
          const state = getPageState();
          state[pageId] = isExpanded;
          localStorage.setItem(PAGE_STORAGE_KEY, JSON.stringify(state));
        } catch (e) {}
      }
      
      // Find and mark current page first
      const currentPath = window.location.pathname;
      const currentHash = window.location.hash;
      let currentPageId = null;
      
      document.querySelectorAll('.sidebar a[data-page]').forEach(link => {
        const linkPath = link.getAttribute('data-page');
        const normalizedCurrent = currentPath.replace(/\/$/, '') || '/index.html';
        const normalizedLink = linkPath.replace(/\/$/, '');
        
        if (normalizedCurrent === normalizedLink || 
            normalizedCurrent === normalizedLink + '.html' ||
            normalizedCurrent + '.html' === normalizedLink ||
            (normalizedCurrent === '/' && normalizedLink === '/index.html') ||
            (normalizedCurrent === '/index.html' && normalizedLink === '/')) {
          
          link.classList.add('active');
          const pageItem = link.closest('.page-item');
          if (pageItem) {
            currentPageId = pageItem.getAttribute('data-page-id');
            pageItem.classList.remove('collapsed');
          }
        }
      });
      
      if (currentHash) {
        const headingId = currentHash.substring(1);
        document.querySelectorAll('.page-headings a[data-heading]').forEach(link => {
          if (link.getAttribute('data-heading') === headingId) {
            link.classList.add('active');
          }
        });
      }
      
      // Listen for hash changes and update heading highlight
      window.addEventListener('hashchange', () => {
        const newHash = window.location.hash;
        // Remove all active headings
        document.querySelectorAll('.page-headings a.active').forEach(link => {
          link.classList.remove('active');
        });
        // Add active class to the new heading
        if (newHash) {
          const headingId = newHash.substring(1);
          document.querySelectorAll('.page-headings a[data-heading]').forEach(link => {
            if (link.getAttribute('data-heading') === headingId) {
              link.classList.add('active');
            }
          });
        }
      });
      
      // Initialize page state - only for pages that are NOT current
      const pageState = getPageState();
      document.querySelectorAll('.page-item').forEach(pageItem => {
        const pageId = pageItem.getAttribute('data-page-id');
        // Only apply localStorage if this is NOT the current page
        if (pageId && pageId !== currentPageId && pageState[pageId] === true) {
          pageItem.classList.remove('collapsed');
        }
      });
      
      // Page click handlers - only toggle if clicking current page, otherwise navigate
      document.querySelectorAll('.page-link').forEach(link => {
        link.addEventListener('click', function(e) {
          const pageItem = this.closest('.page-item');
          const headings = pageItem ? pageItem.querySelector('.page-headings') : null;
          
          // Only toggle if this is the active page AND has headings
          if (this.classList.contains('active') && headings && headings.children.length > 0) {
            e.preventDefault();
            const pageId = pageItem.getAttribute('data-page-id');
            pageItem.classList.toggle('collapsed');
            const isExpanded = !pageItem.classList.contains('collapsed');
            savePageState(pageId, isExpanded);
          }
          // Otherwise, let the link navigate normally
        });
      });
    </script>
    
    <footer class="site-footer">
      <div class="footer-content">
        <div class="footer-support">
          <h4>Support</h4>
          <p>If you find this project useful, consider supporting its development:</p>
          <div class="support-links">
            <a href="https://buymeacoffee.com/paxx12" class="support-link" title="Buy Me A Coffee">â˜• Coffee</a>
            <a href="https://snapmaker-eu.myshopify.com?ref=paxx12" class="support-link" title="EU Store">ðŸ‡ªðŸ‡º Store</a>
            <a href="https://snapmaker-us.myshopify.com?ref=paxx12" class="support-link" title="US Store">ðŸ‡ºðŸ‡¸ Store</a>
          </div>
        </div>
        {% if site.github.private != true and site.github.license %}
        <div class="footer-contribute">
          <p>This site is open source. <a href="{{ site.github.repository_url }}">Improve this page</a>.</p>
        </div>
        {% endif %}
      </div>
    </footer>
    
    <style>
      .site-footer {
        margin-top: 4rem;
        padding: 2rem 1rem;
        border-top: 1px solid var(--border-color);
        background-color: var(--code-bg);
        text-align: center;
      }
      
      .footer-content {
        max-width: 900px;
        margin: 0 auto;
      }
      
      .footer-support h4 {
        margin: 0 0 0.5rem 0;
        color: var(--text-color);
        font-size: 0.95rem;
      }
      
      .footer-support p {
        margin: 0 0 0.75rem 0;
        color: var(--text-color);
        font-size: 0.85rem;
        opacity: 0.8;
      }
      
      .support-links {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .support-link {
        display: inline-block;
        padding: 0.4rem 0.8rem;
        background-color: var(--bg-color);
        color: var(--link-color);
        border-radius: 4px;
        text-decoration: none;
        font-size: 0.85rem;
        transition: all 0.2s ease;
        border: 1px solid var(--border-color);
      }
      
      .support-link:hover {
        color: var(--link-hover);
        background-color: var(--border-color);
        text-decoration: none;
      }
      
      .footer-contribute {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border-color);
      }
      
      .footer-contribute p {
        margin: 0;
        color: var(--text-color);
        font-size: 0.85rem;
        opacity: 0.8;
      }
      
      .footer-contribute a {
        color: var(--link-color);
        text-decoration: none;
      }
      
      .footer-contribute a:hover {
        text-decoration: underline;
        color: var(--link-hover);
      }
    </style>
  </body>
</html>
